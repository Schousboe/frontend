---
import Layout from "~/layouts/Layout.astro";
import Section from "~/components/Section.astro";
import { getCollection } from "astro:content";
import ExportPreviewVideo from "~/assets/images/screen/video.mp4";
import Earth from "~/assets/images/screen/earth.png";
import { Picture, Image } from "astro:assets";

const repoGroups = await getCollection("repos");
const repoCards = repoGroups.flatMap((group) =>
	group.data.repos.map((repo) => ({
		...repo,
		group: group.data.prettyName,
	}))
);

const paperUrl = "https://research.voxelearth.org";
const gitHubOrgUrl = "https://github.com/VoxelEarth";

const paperCard = {
	name: "Voxel Earth Research Paper",
	description: "Dive into the full technical write-up covering GPU voxelization, streaming, and reconstruction math.",
	url: paperUrl,
	group: "Research",
	starCount: undefined,
	accent: true,
};

const cards = [...repoCards, paperCard];
const numberFormatter = new Intl.NumberFormat("en-US");

const pageMeta = {
	title: "Code",
	pageTitle: "Code | Voxel Earth",
	description: "Browse every Voxel Earth repository, from GPU voxelizers to Minecraft plugins and web viewers.",
};
---

<Layout title={pageMeta.title} pageTitle={pageMeta.pageTitle} description={pageMeta.description}>
	<Section class="bg-white text-slate-900">
		<div class="mx-auto max-w-4xl space-y-6 text-center">
			<p class="text-sm uppercase tracking-[0.35em] text-slate-500">Open Source Stack</p>
			<h1 class="text-4xl font-black text-brand-green md:text-5xl">Voxel Earth Code</h1>
			<p class="text-lg text-slate-600 md:text-xl">
				Snappy GPU kernels, Minecraft plugins, and web viewers that turn real-world photogrammetry into playable
				voxel terrain. Tap a tile to explore every repository.
			</p>
			<div class="flex flex-wrap justify-center gap-4 pt-2 mb-6">
				<a
					href={gitHubOrgUrl}
					target="_blank"
					rel="noopener noreferrer"
					class="inline-flex items-center gap-2 rounded-full border border-brand-green/30 bg-white px-6 py-3 text-sm font-semibold uppercase tracking-[0.25em] text-slate-900 transition hover:bg-brand-green/10"
				>
					GitHub Org
					<svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 17 17 7M9 7h8v8" />
					</svg>
				</a>
				<a
					href={paperUrl}
					target="_blank"
					rel="noopener noreferrer"
					class="inline-flex items-center gap-2 rounded-full bg-brand-green/90 px-6 py-3 text-sm font-semibold uppercase tracking-[0.25em] text-white transition hover:bg-brand-green"
				>
					Read the Paper
					<svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 17 17 7M9 7h8v8" />
					</svg>
				</a>
			</div>
		</div>
	</Section>

	<Section class="bg-gradient-to-b from-white via-emerald-50/40 to-white">
		<div class="grid gap-8 lg:grid-cols-2">
			<div class="rounded-[32px] border border-brand-green/30 bg-white/90 p-10 shadow-[0_25px_60px_rgba(22,101,76,0.12)]">
				<p class="text-xs font-semibold uppercase tracking-[0.45em] text-brand-green/70">Want to host your own?</p>
				<h2 class="mt-3 text-3xl font-black text-slate-900">Spin up your own Earth</h2>
				<div class="mt-4 overflow-hidden rounded-2xl border border-slate-200 shadow-inner">
					<Picture
						src={Earth}
						alt="Voxel Earth Single Scene export preview"
						class="w-full object-cover"
						loading="lazy"
					/>
				</div>
				<p class="mt-4 text-lg leading-relaxed text-slate-600">
				Hosting Voxel Earth is as simple as dropping two jars into your{' '}
				<code class="rounded bg-slate-900/90 px-2 py-1 text-sm text-white">plugins</code> folder.
				Download the latest Voxel Earth plugin from{' '}
				<a
					class="underline decoration-brand-green/50 decoration-2 underline-offset-4"
					href="https://github.com/ryanhlewis/VoxelEarth/releases"
					target="_blank"
					rel="noopener noreferrer"
				>
					GitHub Releases
				</a>{' '}
				and grab a matching build of FastAsyncWorldEdit (FAWE) from{' '}
				<a
					class="underline decoration-brand-green/50 decoration-2 underline-offset-4"
					href="https://github.com/IntellectualSites/FastAsyncWorldEdit/releases"
					target="_blank"
					rel="noopener noreferrer"
				>
					their releases page
				</a>
				. Then just start a Bukkit/Spigot/Paper server on 1.20+ (Java 21+), and you&rsquo;re ready to explore.
				</p>
				<div class="mt-6 space-y-3 text-base text-slate-600">
				<p class="flex items-start gap-3">
					<span class="mt-1 inline-flex size-5 items-center justify-center rounded-full bg-brand-green/10 text-brand-green">
					1
					</span>
					<span>
					Download the latest <strong>Voxel Earth</strong> plugin jar from{' '}
					<a
						class="underline decoration-brand-green/50 decoration-2 underline-offset-4"
						href="https://github.com/ryanhlewis/VoxelEarth/releases"
						target="_blank"
						rel="noopener noreferrer"
					>
						GitHub Releases
					</a>
					.
					</span>
				</p>
				<p class="flex items-start gap-3">
					<span class="mt-1 inline-flex size-5 items-center justify-center rounded-full bg-brand-green/10 text-brand-green">
					2
					</span>
					<span>
					Download a <strong>FastAsyncWorldEdit (FAWE)</strong> build that matches your server version from{' '}
					<a
						class="underline decoration-brand-green/50 decoration-2 underline-offset-4"
						href="https://github.com/IntellectualSites/FastAsyncWorldEdit/releases"
						target="_blank"
						rel="noopener noreferrer"
					>
						FAWE&rsquo;s GitHub releases
					</a>
					.
					</span>
				</p>
				<p class="flex items-start gap-3">
					<span class="mt-1 inline-flex size-5 items-center justify-center rounded-full bg-brand-green/10 text-brand-green">
					3
					</span>
					<span>
					Drop both jars into the <code class="rounded bg-slate-900/90 px-2 py-0.5 text-xs text-white">plugins</code> folder of
					your <strong>Paper/Spigot/Bukkit 1.20+</strong> server (Java 21+), accept the EULA, and start the server to begin
					streaming real-world locations into Minecraft.
					</span>
				</p>
				</div>
			</div>

			<div class="rounded-[32px] border border-brand-green/20 bg-white/80 p-10 shadow-[0_25px_60px_rgba(0,0,0,0.08)]">
				<p class="text-xs font-semibold uppercase tracking-[0.45em] text-rose-500/70">Just need a schematic?</p>
				<h2 class="mt-3 text-3xl font-black text-slate-900">Export locations in your browser</h2>
				<div class="mt-4 overflow-hidden rounded-2xl border border-slate-200 shadow-inner bg-slate-900/80">
					<video
						src={ExportPreviewVideo}
						autoplay
						loop
						muted
						playsinline
						class="h-full w-full object-cover"
					/>
				</div>
				<p class="mt-5 text-lg leading-relaxed text-slate-600">
					Head to <a class="underline decoration-rose-400/60 decoration-2 underline-offset-4" href="https://beta.voxelearth.org" target="_blank" rel="noopener noreferrer">beta.voxelearth.org</a>,
					click the <strong>Single Scene</strong> toggle in the top-left, and pan anywhere on the planet. You&rsquo;ll get a live Minecraft preview plus export options for
					<strong>NBT</strong>, <strong>schem</strong>, or <strong>mcfunction</strong>. Perfect when you just need a skyline or landmark for your own world.
				</p>
				<ul class="mt-5 space-y-2 text-base text-slate-600">
					<li class="flex items-start gap-3">
						<span class="mt-1 inline-flex size-3 rounded-full bg-rose-500"></span>
						<span>Select <strong>any coordinate</strong> and see voxel fidelity before you export.</span>
					</li>
					<li class="flex items-start gap-3">
						<span class="mt-1 inline-flex size-3 rounded-full bg-rose-500"></span>
						<span>Exports ship as <strong>NBT / schem / mcfunction</strong> so they drop into WorldEdit, Amulet, or raw data packs.</span>
					</li>
					<li class="flex items-start gap-3">
						<span class="mt-1 inline-flex size-3 rounded-full bg-rose-500"></span>
						<span>No GPU required&mdash;the heavy lifting happens on your browser.</span>
					</li>
				</ul>
			</div>
		</div>
	</Section>

	<Section class="bg-[#F4F8F2]">
		<div class="grid grid-cols-1 gap-6 sm:grid-cols-2 xl:grid-cols-3">
			{cards.map((card) => (
				<a
					href={card.url}
					target="_blank"
					rel="noopener noreferrer"
					class={`group relative flex min-h-[240px] flex-col justify-between rounded-[28px] border p-6 shadow-xl transition duration-200 hover:-translate-y-1.5 hover:border-brand-green hover:shadow-[0_24px_45px_rgba(21,127,113,0.2)] ${
						card.accent ? "bg-gradient-to-br from-emerald-100 via-lime-50 to-amber-100 text-slate-900 border-transparent" : "bg-white text-slate-900 border-brand-green/20"
					}`}
					aria-label={`Open ${card.name}`}
				>
					<div>
						<p class={`text-xs font-semibold uppercase tracking-[0.4em] ${card.accent ? "text-slate-900/70" : "text-brand-green/70"}`}>
							{card.group}
						</p>
						<h2 class={`mt-4 text-2xl font-semibold ${card.accent ? "text-slate-900" : "text-slate-900"}`}>{card.name}</h2>
						<p class={`mt-3 text-base leading-relaxed ${card.accent ? "text-slate-900/80" : "text-slate-700"}`}>{card.description}</p>
					</div>

					<div class="mt-6 flex items-center justify-between text-sm font-semibold">
						<div class={`flex items-center gap-2 ${card.accent ? "text-slate-900/75" : "text-slate-600"}`}>
							{typeof card.starCount === "number" ? (
								<>
									<svg width="18" height="18" viewBox="0 0 24 24" class="text-yellow-300" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
										<path d="m12 2.25 2.47 6.32 6.78.19-5.27 4.34 1.83 6.45L12 15.77 6.19 19.55l1.83-6.45-5.27-4.34 6.78-.19z" />
									</svg>
									<span>{numberFormatter.format(card.starCount)} stars</span>
								</>
							) : (
								<span class="inline-flex items-center gap-2">
									<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="text-current" stroke-width="1.5" aria-hidden="true">
										<path d="M5 12h14M5 12a7 7 0 0 1 7-7v0a7 7 0 0 1 7 7M5 12a7 7 0 0 0 7 7v0a7 7 0 0 0 7-7" stroke-linecap="round" stroke-linejoin="round" />
									</svg>
									<span>Deep dive</span>
								</span>
							)}
						</div>
						<span class={`inline-flex items-center gap-1 transition ${card.accent ? "text-slate-900" : "text-brand-green"}`}>
							{card.accent ? "Open paper" : "Open repo"}
							<svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 17 17 7M9 7h8v8" />
							</svg>
						</span>
					</div>
				</a>
			))}
		</div>
	</Section>
</Layout>
